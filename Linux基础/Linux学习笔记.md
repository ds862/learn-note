# 第五章、**Linux** 的文件权限与目录配置

## 5.1 使用者与群组

1. 文件拥有者User
2. 群组Group
3. 其他人Others
4. Linux 使用者身份与群组记录的文件

- 默认的情况下，所有的系统上的帐号与一般身份使用者，还有root的相关信息， 都记录在/etc/passwd

- 个人的密码则是记录在/etc/shadow

##  5.2  **Linux** 文件权限概念 

1. Linux文件属性

- su - 切换root身份
- ls -a 列出所有文件（包含隐藏文件）
- ls -al 列出所有的文件详细的权限与属性 （包含隐藏文件）
- 文件属性示意图

<img src="./image-20200706154413973.png" alt="文件属性示意图" style="zoom:40%;" />

- 第一栏代表这个文件的类型与权限（permission）： 

   <img src="./image-20200706154710544.png" alt="image-20200706154710544" style="zoom:40%;" />

   - 第一个字符代表这个文件是“目录、文件或链接文件等等”： 

     - 当为[ d ]则是目录

     - 当为[ - ]则是文件

     - 若是[ l ]则表示为链接文件（link file）； 

     - 若是[ b ]则表示为设备文件里面的可供储存的周边设备（可随机存取设备）； 

     - 若是[ c ]则表示为设备文件里面的序列埠设备，例如键盘、鼠标

   - 接下来的字符中，以三个为一组，且均为“rwx” 的三个参数的组合。

- 第二栏表示有多少文件名链接到此节点（i-node）

- 第三栏表示这个文件（或目录）的“拥有者帐号” 

- 第四栏表示这个文件的所属群组 
- 第五栏为这个文件的容量大小，默认单位为Bytes
- 第六栏为这个文件的创建日期或者是最近的修改日期
- 第七栏为这个文件的文件名 

> 例题：drwxr-xr-- 1 test1 testgroup 5238 Jun 19 10:25 groups/ 
>
> - 文件拥有者test1[rwx]可以在本目录中进行任何工作； 
>
> - 而testgroup这个群组[r-x]的帐号，例如test2, test3亦可以进入本目录进行工作，但是不能 
>
>   在本目录下进行写入的动作；
>
> - 至于other的权限中[r--]虽然有r ，但是由于没有x的权限，因此others的使用者，并不能进 
>
>   入此目录！ 

- root基本上是不受系统的权限所限制的， 所以无论文件权限为何，**默认root都可以存取**



2. 如何改变文件属性与权限

- chgrp ：改变文件所属群组 

- chown ：改变文件拥有者 

* chmod ：改变文件的权限, SUID, SGID, SBIT等等的特性 

- 改变所属群组, chgrp 
- -r: 进行递回（recursive）的持续变更，亦即连同次目录下的所有文件、目录都更新成为这个群组之意。常常用在变更某一目录内所有的文件之情况。 

3. 目录与文件之权限意义

- 权限对文件的重要性 
  - r （read）：可读取此一文件的实际内容，如读取文本文件的文字内容等； 
  - w （write）：可以编辑、新增或者是修改该文件的内容（但不含删除该文件）；
    - 当你对一个文件具有w权限时，可以具有写入/编辑/新增/修改 文件的内容的权限， **但并不具备有删除该文件本身的权限！** 
  - x （eXecute）：该文件具有可以被系统执行的权限。 
    - 在Windows下一个文件是否具有执行的能力是借由“ 扩展名 ”来判断的，例如：.exe, .bat, .com 等，但在Linux下，文件是否能被执行，则是借由是否具有“x”这个权限来决定的！跟文件名是没有绝对的关系！

- 权限对目录的重要性 

  - r （read contents in directory）： 

    表示具有读取目录结构清单的权限，所以当你具有读取（r）一个目录的权限时，表示你可以查询该目录下的文件名数据。 所以你就可以利用 ls 这个指令将该目录的内容列表显示出来！

  - w （modify contents of directory）： 

    这个可写入的权限对目录来说，是很了不起的！ 因为他表示你具有异动该目录结构清单的权限，也就是下面这些权限： 

    - 创建新的文件与目录； 

    - **删除已经存在的文件与目录（不论该文件的权限为何！）** 

    - 将已存在的文件或目录进行更名； 

    - 搬移该目录内的文件、目录位置。

  - x （access directory）： 

    咦！目录的执行权限有啥用途啊？目录只是记录文件名而已，总不能拿来执行吧？没错！目录不可以被执行，目录的x代表的是使用者能否进入该目录成为工作目录的用途！ 所谓的工作目录（work directory）就是你目前所在的目录啦！

  -  x 在目录当中是与“能否进入该目录”有关， 至于 w 则具有相当重要的权限，因为他可以让使用者删除、更新、新建文件或目录

<img src="./image-20200706165155001.png" alt="image-20200706165155001" style="zoom:45%;" />

> 例：drwxr--r-- 3 root root 4096 Jun 25 08:35 .ssh 
>
> 系统有个帐号名称为vbird，这个帐号并没有支持root群组，请问vbird对这个目录有何权限？ 是否可切换到此目录中？
>
> 答：vbird对此目录仅具有r的权限，因此vbird可以查询此目录下的文件名列表。因为vbird不具有x的权限，亦即 vbird 没有这个抽屉的钥匙啦！ 因此vbird并不能切换到此目录内！（相当重要的概念！）

4.  Linux文件种类与扩展名 

- 文件种类：

- 文件扩展名

  基本上，Linux的文件是没有所谓的“扩展名”的，我们刚刚就谈过，一个Linux文件能不能被执行，与他的第一栏的十个属性有关， 与文件名根本一点关系也没有。基本上，Linux系统上的文件名真的只是让你了解该文件可能的用途而已， 真正的执行与否仍然需要权限的规范才行！

## 5.3 Linux目录配置 

1. **Linux**目录配置的依据**--FHS** 

FHS针对目录树架构仅定义出三层目录下面应该放置什么数据而已，分别是下面这 三个目录的定义：

- / （root, 根目录）：与开机系统有关； 

- /usr （unix software resource）：与软件安装/执行有关； 

- /var （variable）：与系统运行过程有关

- “帐号”的角度来看，所谓的 root 指的是“系统管理员！”的身份， 如果以“目录”的角度来看，所谓的 root 意即指的是根目录，就是 /

2.  目录树

在Linux下面，所有的文件与目录都是由根目录开始的！那是所有目录与文件的源头， 然后再一个一个的分支下来，有点像是树枝状，因此，我们也称这种目录配置方式为：“目录树（directory tree）” 

3. 绝对路径与相对路径 

- 绝对路径：由根目录（/）开始写起的文件名或目录名称， 例如 /home/dmtsai/.bashrc； 

- 相对路径：相对于目前路径的文件名写法。 例如 ./home/dmtsai 或 ../../home/dmtsai/ 等。反正开头不是 / 就属于相对路径的写法 
  - .  代表当前的目录，也可以使用 ./ 来表示； 
  - .. 代表上一层目录，也可以 ../ 来代表。

# 第六章、Linux 文件与目录管理

## 6.1 目录与路径
1. 相对路径与绝对路径   

2. 目录的相关操作  

> .代表此层目录  
> ..代表上一层目录   
> -代表前一个工作目录   
> ~代表“目前使用者身份”所在的主文件夹   
> ~account 代表account这个使用者的主文件夹（account是个帐号名称）

- 常用的目录处理指令：  

> cd：变换目录 change directory
>
> pwd：显示目前的目录 Print Working Directory  
> mkdir：创建一个新的目录  make directory
> 			   -m ：设置文件的权限喔！直接设置，不需要看默认权限 （umask） 的脸色～ 
>
> ​			   -p ：帮助你直接将所需要的目录（包含上层目录）递回创建起来！ 
>
> rmdir：删除一个空的目录
>
> ​				-p ：连同“上层”“空的”目录也一起删除 
>
> ​				-r : 删除目录下文件

3. `echo $PATH`查看环境变量
   PATH（一定是大写）这个变量的内容是由一堆目录所组成的，每个目录中间用冒号（:）来隔开， 每个目录是有“顺序”之分的。

## 6.2 文件与目录管理

1. 文件与目录的检视： **ls**

2. 复制、删除与移动（更名）： **cp, rm, mv**

   cp [-adfilprsu] 来源文件（source） 目标文件（destination） 

    rm [-fir] 文件或目录

   mv [-fiu] source destination 

3. **basename** 与 **dirname**：取得路径的文件名称与目录名称

   ```
   [root@study ~]# basename /etc/sysconfig/network 
   network &lt;== 很简单！就取得最后的文件名～ 
   [root@study ~]# dirname /etc/sysconfig/network 
   /etc/sysconfig &lt;== 取得的变成目录名了！
   ```

## **6.3** 文件内容查阅

1. 查阅文件指令

* cat 由第一行开始显示文件内容 , cat 是 Concatenate的缩写

* tac 从最后一行开始显示，可以看出 tac 是 cat 的倒着写！ 

* nl 显示的时候，顺道输出行号！ 

* more 一页一页的显示文件内容 

* less 与 more 类似，但是比 more 更好的是，他可以往前翻页！ 

* head 只看头几行 

  - -n ：后面接数字，代表显示几行的意思 

* tail 只看尾巴几行 

  - -n ：后面接数字，代表显示几行的意思 
    - “tail **-n +100** /etc/man_db.conf” 代表该文件从100行以后都会被列出来

  - -f ：表示持续侦测后面所接的文件名，要等到按下[ctrl]-c才会结束tail的侦测 

* od 以二进制的方式读取文件内容！ 

2. 修改文件时间或创建新文件： **touch**

- **modification time** （**mtime**）：当该文件的“内容数据”变更时，就会更新这个时间！内容数据指的是文件的内容，而不是文件的属性或权限喔

- **status time** （**ctime**）： 当该文件的“状态 （status）”改变时，就会更新这个时间，举例来说，像是权限与属性被更改了，都会更新这个时间。
- **access time** （**atime**）： 当“该文件的内容被取用”时，就会更新这个读取时间 （access）。举例来说，我们使用 cat 去读取 /etc/man_db.conf ， 就会更新该文件的 atime 了。 

3. touch 这个指令最常被使用的情况是： 

* 创建一个空的文件； 
* 将某个文件日期修订为目前 （mtime 与 atime）

## **6.4** 文件与目录的默认权限与隐藏权限

1. 文件默认权限：**umask**

- 若使用者创建为“文件”则默认“没有可执行（ x ）权限”，亦即只有 rw 这两个项目，也就是最大为 666 分，默认权限如下： -rw-rw-rw- 

- 若使用者创建为“目录”，则由于 x 与是否可以进入此目录有关，因此默认为所有权限均开放，亦即为 777 分，默认权限如下： drwxrwxrwx 

